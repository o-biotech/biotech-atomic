name: build
on: push
jobs:
  build:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os:
          - ubuntu-22.04
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2
        with:
          fetch-depth: 0
        
      - name: Deno Setup
        uses: denoland/setup-deno@v1.1.0
        with:
          deno-version: v1.x.x

      - name: Deno Build
        run: deno task build

      - name: New Version
        run: |
          echo "New version is ${{ steps.semver.outputs.version }}"
          echo "TOKEN ${{ secrets.FATHYM_GITHUB_TOKEN }}"

      - name: Tag commit
        # if: ${{ fromJSON(steps.changed.outputs.result) }}
        env:
          GITHUB_TOKEN: ${{ secrets.FATHYM_GITHUB_TOKEN }}
        run: |
          git tag ${{ steps.semver.outputs.version }} ${{ steps.commit.outputs.commit }}
          git push origin ${{ steps.semver.outputs.version }}